!function(e,t){var n,o=["loki"];"function"==typeof define&&define.amd?define(o,t):"object"==typeof module&&module.exports?(n=function(e){return require(e)},module.exports=t.apply(e,o.map(n))):(n=function(t){return e[t]},e.LokiCordova=t.apply(e,o.map(n)))}("undefined"!=typeof self?self:this,function(){"use strict";const e=Array.prototype.slice.call(arguments)[0];var t=function(){function e(e,t){for(var n in t){var o=t[n];o.configurable=!0,o.value&&(o.writable=!0)}Object.defineProperties(e,t)}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=Object.assign;function i(e){n(this,i),this.options=o({prefix:"loki",target_location:cordova.file.dataDirectory},e)}var r={},a=function(e){function t(){n(this,t),null!=e&&e.apply(this,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}(t,e),t}(Error);r.deleteDatabase={value:function(e,t){var n=this;window.resolveLocalFileSystemURL(n.options.target_location,function(o){var i=n.options.prefix+"__"+e;o.getFile(i,{create:!0},function(e){e.remove(function(){t()},function(e){throw new a("Unable delete file"+JSON.stringify(e))})},function(e){throw new a("Unable delete database"+JSON.stringify(e))})},function(e){throw new a("Unable to resolve local file system URL"+JSON.stringify(e))})}},r.loadDatabase={value:function(e,t){this._getFile(e,function(e){e.file(function(e){var n=new FileReader;n.onloadend=function(e){var n=e.target.result;0===n.length?t(null):t(n)},n.readAsText(e)},function(e){t(new a("Unable to read file"+e.message))})},function(e){t(new a("Unable to get file: "+e.message))})}},r.saveDatabase={value:function(e,t,n){var o=this;this._getFile(e,function(e){e.createWriter(function(e){e.onwriteend=function(){if(0===e.length){var i=o._createBlob(t,"text/plain");e.write(i),n()}},e.truncate(0)},function(e){throw new a("Unable to write file"+JSON.stringify(e))})},function(e){throw new a("Unable to get file"+JSON.stringify(e))})}},r._createBlob={value:function(e,t){var n;try{n=new Blob([e],{type:t})}catch(i){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===i.name&&window.BlobBuilder){var o=new window.BlobBuilder;o.append(e),n=o.getBlob(t)}else{if("InvalidStateError"!==i.name)throw new a("Unable to create blob"+JSON.stringify(i));n=new Blob([e],{type:t})}}return n}},r._getFile={value:function(e,t,n){var o=this;window.resolveLocalFileSystemURL(o.options.target_location,function(i){var r=o.options.prefix+"__"+e;i.getFile(r,{create:!0},t,n)},function(e){throw new a("Unable to resolve local file system URL"+JSON.stringify(e))})}},t(i,r);const l=function(){const e={type:"eqJoin",joinData:"[%lktxp]data",leftJoinKey:"[%lktxp]left_key",rightJoinKey:"[%lktxp]right_key"};return{left_join:[e],left_join_strict:[e,{type:"where",value:({right:e})=>e&&void 0!==e.$loki}],save_:function(e){return new Promise(function(t,n){e.saveDatabase(e=>e?n(e):t())})},upsertByQuery:function(e,t,n){const o=e.findOne(n);return o?(e.update(Object.assign(o,t)),0):(e.insert(t),1)},upsertByKey:function(e,t,n="id"){const o=e.findOne({[n]:t[n]});return o?(e.update(Object.assign(o,t)),0):(e.insert(t),1)},upsertByUnique:function(e,t,n="id"){const o=t[n],i="$loki"===n,r=void 0!==o,a=i?r?e.get(o):null:e.by(n,o);if(a)return e.update(Object.assign(a,t)),0;if(i&&r)throw new Error("Klíči `$loki` nelze nastavit jakoukoliv hodnotu! Tato funkce tedy akceptuje pouze vyplnění existujícím záznamem, či nevyplněno (=přidání nového záznamu).");return e.insert(t),1},upsertByCallbacks:function(e,t,n=((e,{id:t})=>e.findOne({id:t}))){return function(o){const i=n(e,o);return i?(e.update(t(i,o)),0):(e.insert(t(i,o)),1)}}}}();return{FSAdapter:i,FSAdapterError:a,database_:function({db_file:{file:t="db.json",prefix:n="loki"}={},params:o={autoload:!0},tables:r=[],auto_cordova_adapter:a=!0}={}){return a&&(o.adapter=new i({prefix:n})),function(t,n){var o;return new Promise((i,r)=>{n.autoloadCallback=(()=>i(o));try{o=new e(t,n)}catch(e){r(e)}})}(t,o).then(function(e){let t={},n=e.listCollections().map(e=>e.name),o="",i="",a=-1;for(let l=0,u=r.length;l<u;l++)o=r[l],i="addCollection",n.length&&-1!==(a=n.indexOf(o))&&(n.splice(a,1),i="getCollection"),t[o]=e[i](o);for(let t=0,o=n.length;t<o;t++)e.removeCollection(n[t]);return e.saveDatabase(),{db:e,db_utils:l,tb:t}})}}});